<div class="form-container">
    <form method="post">
        {% if params.properties|length == 0 %}
            <div class="no-params">This tool takes no parameters.</div>
        {% endif %}
        {% for param, info in params.properties.items() %}
        <div class="field {% if info.type == 'array' %}array-field{% endif %}">
            <label for="{{ param }}">{{ param }}{% if info.type %} <span class="badge">{{ info.type }}</span>{% endif %}</label>
            {% if info.description %}<div class="hint">{{ info.description }}</div>{% endif %}
            {% if info.enum %}
                <select class="enum-select" name="{{ param }}" id="{{ param }}">
                    {% for opt in info.enum %}
                    <option value="{{ opt }}">{{ opt }}</option>
                    {% endfor %}
                </select>
            {% elif info.type == 'array' %}
                <textarea name="{{ param }}" id="{{ param }}" placeholder='Enter JSON array, e.g. ["a", "b"]'></textarea>
            {% else %}
                <input type="text" name="{{ param }}" id="{{ param }}" placeholder="Enter {{ param }}" />
            {% endif %}
        </div>
        {% endfor %}
        <div class="actions">
            <button type="submit"><i class="fas fa-play"></i> Run {{ tool_name }}</button>
            <a href="#" onclick="loadPage('tools')" class="secondary" style="text-decoration:none;padding:10px 18px;border-radius:5px;display:inline-flex;align-items:center;gap:8px;">â¬… Back</a>
        </div>
    </form>
    <div id="tool-result-container" style="display: none;">
        <div class="result-header"><i class="fas fa-stream"></i> Result</div>
        <pre id="tool-result-output"></pre>
    </div>
</div>
<script>
(function() {
    const form = document.querySelector('.form-container form');
    form.addEventListener('submit', async (event) => {
        event.preventDefault();
        const formData = new FormData(form);
        const resultContainer = document.getElementById('tool-result-container');
        const resultOutput = document.getElementById('tool-result-output');

        resultOutput.textContent = 'Running...';
        resultContainer.style.display = 'block';

        try {
            const response = await fetch(form.action, {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            if (data.success) {
                resultOutput.textContent = data.result;
            } else {
                resultOutput.textContent = 'Error: ' + data.error;
            }
        } catch (error) {
            resultOutput.textContent = 'An unexpected error occurred: ' + error.toString();
        }
    });
})();
</script>
